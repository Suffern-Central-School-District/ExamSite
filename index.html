<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Exam Editor</title>

<style>
@page {
    size: 8.5in 11in;
    margin: 1in;
}

body {
    margin: 0;
    padding: 1in;
    font-family: "Times New Roman", Times, serif;
    font-size: 14pt;
    line-height: 1.5;
}

#toolbar {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    align-items: center;
    z-index: 1000;
}

button {
    padding: 6px 12px;
    font-size: 14px;
    cursor: pointer;
}

#battery {
    min-width: 50px;
    text-align: center;
    font-size: 14pt;
}

@media print {
    #toolbar {
        display: none;
    }

    body {
        padding: 0;
    }
}

#editor {
    width: 100%;
    outline: none;
    min-height: 9in;
    margin-top: 50px; /* space for toolbar */
}
</style>

<script>
let editorHistory = [];
let historyIndex = -1;
let clipboard = ""; // internal clipboard

// Save editor state for undo
function saveHistory() {
    if (historyIndex < editorHistory.length - 1) {
        editorHistory = editorHistory.slice(0, historyIndex + 1);
    }
    editorHistory.push(document.getElementById('editor').innerHTML);
    historyIndex++;
}

// Undo function
function undo() {
    if (historyIndex > 0) {
        historyIndex--;
        document.getElementById('editor').innerHTML = editorHistory[historyIndex];
    }
}

// Copy selected text within editor
function copyText() {
    const editor = document.getElementById('editor');
    const selection = window.getSelection();
    if (editor.contains(selection.anchorNode)) {
        const range = selection.getRangeAt(0);
        const div = document.createElement('div');
        div.appendChild(range.cloneContents());
        clipboard = div.innerHTML;
    }
}

// Paste internal clipboard at cursor
function pasteText() {
    const editor = document.getElementById('editor');
    editor.focus();
    const sel = window.getSelection();
    if (!sel.rangeCount) return;
    const range = sel.getRangeAt(0);
    range.deleteContents();
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = clipboard;
    const frag = document.createDocumentFragment();
    while (tempDiv.firstChild) {
        frag.appendChild(tempDiv.firstChild);
    }
    range.insertNode(frag);
    saveHistory();
}

// Print document
function printDocument() {
    window.print();
}

// Initialize editor history
function initHistory() {
    saveHistory();
}

// Listen for changes to save history
function attachHistoryListener() {
    const editor = document.getElementById('editor');
    editor.addEventListener('input', saveHistory);
}

// Block reload keys and select-all
document.addEventListener('keydown', function(e) {
    if (e.key === 'F5') { e.preventDefault(); e.stopPropagation(); }
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'r') { e.preventDefault(); e.stopPropagation(); }
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'a') { e.preventDefault(); e.stopPropagation(); }
});

// Prevent page reload via menu or other triggers
window.addEventListener('beforeunload', function(e) {
    e.preventDefault();
    e.returnValue = '';
});

// Disable right-click
document.addEventListener('contextmenu', event => event.preventDefault());

// Battery indicator
async function updateBattery() {
    if (!navigator.getBattery) return; // not supported
    const battery = await navigator.getBattery();
    function refresh() {
        const level = Math.round(battery.level * 100);
        const charging = battery.charging ? "âš¡" : "";
        document.getElementById('battery').textContent = `ðŸ”‹ ${level}%${charging}`;
    }
    refresh();
    battery.addEventListener('levelchange', refresh);
    battery.addEventListener('chargingchange', refresh);
}

// Initialize all on load
window.onload = function() {
    initHistory();
    attachHistoryListener();
    updateBattery();
};
</script>

</head>

<body>

<div id="toolbar">
    <button onclick="copyText()">Copy</button>
    <button onclick="pasteText()">Paste</button>
    <button onclick="undo()">Undo</button>
    <button onclick="printDocument()">Print</button>
    <span id="battery">ðŸ”‹ --%</span>
</div>

<div id="editor"
     contenteditable="true"
     spellcheck="false"
     autocomplete="off"
     autocorrect="off"
     autocapitalize="off">

Suffern High School<br>* * *<br>
Name:<br>
Grade:<br>
Teachers Name:<br>
Date:<br>
Exam:<br>
* * *<br><br>

</div>

</body>
</html>
